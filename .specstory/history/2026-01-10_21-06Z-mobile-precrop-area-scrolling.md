<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 4528d81c-9201-451a-9638-0b2c4acac546 (2026-01-10 21:06Z) -->

# Mobile precrop area scrolling (2026-01-10 21:06Z)

_**User (2026-01-10 20:05Z)**_

on mobile when i'm dragging for the precrop area the page below scrolls. it shouldn't

---

_**Agent (model composer-1, mode Agent)**_

---

Searching for the image cropper component and its drag handling to prevent page scrolling during drag.

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "image cropper precrop area drag mobile touch" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `packages/hip-ui/src/components/image-cropper/index.tsx` | L135 |
| `apps/docs/src/components/image-cropper/index.tsx` | L135 |
| `packages/hip-ui/src/components/image-cropper/index.tsx` | L152-266 |
| `apps/docs/src/components/image-cropper/index.tsx` | L152-266 |
| `packages/hip-ui/src/components/image-cropper/index.tsx` | L77-259 |
| `apps/docs/src/components/image-cropper/index.tsx` | L77-259 |
| `packages/hip-ui/src/components/image-cropper/index.tsx` | L66-152 |
| `apps/docs/src/components/image-cropper/index.tsx` | L66-152 |
| `apps/docs/src/docs/components/content/image-cropper.mdx` | L53 |
| `packages/hip-ui/src/components/image-cropper/index.tsx` | L285-320 |
| `apps/docs/src/examples/image-cropper/dialog.tsx` | L16-78 |
| `packages/hip-ui/src/components/number-field/usePointerLock.tsx` | L2-157 |
| `apps/docs/src/components/image-cropper/index.tsx` | L285-320 |
| `apps/docs/src/examples/image-cropper/basic.tsx` | L22 |
| `apps/docs/src/components/number-field/usePointerLock.tsx` | L2-157 |

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

</details>
</tool-use>

---

---

The component already has `touchAction: "none"` on the root, but touch events may still bubble and cause scrolling. Checking how the underlying library handles touch events and adding handlers to prevent default behavior:

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "prevent default touchmove touchstart mobile scroll prevent" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `packages/hip-ui/src/components/number-field/usePointerLock.tsx` | L2-157 |
| `apps/docs/src/components/number-field/usePointerLock.tsx` | L2-157 |
| `packages/hip-ui/src/components/editable-text/index.tsx` | L60-197 |
| `apps/docs/src/components/editable-text/index.tsx` | L60-197 |
| `packages/hip-ui/src/components/navbar/useAnimatedNavbar.tsx` | L38-158 |
| `packages/hip-ui/src/components/sidebar/index.tsx` | L155-197 |
| `packages/hip-ui/src/components/number-field/usePointerLock.tsx` | L157 |
| `apps/docs/src/components/navbar/useAnimatedNavbar.tsx` | L38-158 |
| `apps/docs/src/components/sidebar/index.tsx` | L155-197 |
| `apps/docs/src/components/editable-text/index.tsx` | L88-197 |
| `apps/docs/src/components/number-field/usePointerLock.tsx` | L157 |
| `packages/hip-ui/src/components/number-field/index.tsx` | L38-115 |
| `packages/hip-ui/src/components/editable-text/index.tsx` | L88-197 |
| `apps/docs/src/routes/__root.tsx` | L123-209 |

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

</details>
</tool-use>

---

---

Adding touch event handlers to prevent default behavior during drag, since `touchAction: "none"` may not be sufficient on mobile. Updating the component:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -6,5 +6,5 @@
  import { useEffectEvent } from "@react-aria/utils";
  import * as stylex from "@stylexjs/stylex";
- import { useEffect, useState } from "react";
+ import { useEffect, useRef, useState } from "react";

  import type { StyleXComponentProps } from "../theme/types";
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -168,4 +168,5 @@
  }: ImageCropperRootProps) {
    const [imageUrl, setImageUrl] = useState&lt;string&gt;(() =&gt; "");
+   const rootRef = useRef&lt;HTMLDivElement&gt;(null);

    const handleError = () =&gt; {
```

**Chunk 2**
Lines added: 42, lines removed: undefined

```diff
@@ -192,4 +193,46 @@
      return createImageUrl();
    }, [image]);
+
+   // Prevent page scrolling on mobile when dragging
+   useEffect(() =&gt; {
+     const rootElement = rootRef.current;
+     if (!rootElement) return;
+
+     let isDragging = false;
+
+     const handleTouchStart = (e: TouchEvent) =&gt; {
+       isDragging = true;
+     };
+
+     const handleTouchMove = (e: TouchEvent) =&gt; {
+       if (isDragging) {
+         e.preventDefault();
+       }
+     };
+
+     const handleTouchEnd = () =&gt; {
+       isDragging = false;
+     };
+
+     rootElement.addEventListener("touchstart", handleTouchStart, {
+       passive: false,
+     });
+     rootElement.addEventListener("touchmove", handleTouchMove, {
+       passive: false,
+     });
+     rootElement.addEventListener("touchend", handleTouchEnd, {
+       passive: false,
+     });
+     rootElement.addEventListener("touchcancel", handleTouchEnd, {
+       passive: false,
+     });
+
+     return () =&gt; {
+       rootElement.removeEventListener("touchstart", handleTouchStart);
+       rootElement.removeEventListener("touchmove", handleTouchMove);
+       rootElement.removeEventListener("touchend", handleTouchEnd);
+       rootElement.removeEventListener("touchcancel", handleTouchEnd);
+     };
+   }, []);

    return (
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -239,4 +239,5 @@
      &lt;OriginCropper.Root
        {...props}
+       ref={rootRef}
        image={imageUrl}
        aspectRatio={aspectRatio}
```

</details>

</tool-use>

---

---

Checking for linter errors and verifying the ref approach:

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `packages/hip-ui/src/components/image-cropper/index.tsx`

Lint results

**No lint errors found**

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

</details>
</tool-use>

---

---

Refining the approach: using a callback ref to get the DOM element and preventing document-level scrolling during drag:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 5, lines removed: 1

```diff
@@ -202,5 +202,9 @@

      const handleTouchStart = (e: TouchEvent) =&gt; {
-       isDragging = true;
+       // Only prevent scrolling if the touch starts on the cropper element or its children
+       const target = e.target as Node;
+       if (rootElement.contains(target)) {
+         isDragging = true;
+       }
      };

```

**Chunk 2**
Lines added: 7, lines removed: undefined

```diff
@@ -214,4 +218,11 @@
        isDragging = false;
      };
+
+     // Prevent document scrolling during drag
+     const handleDocumentTouchMove = (e: TouchEvent) =&gt; {
+       if (isDragging) {
+         e.preventDefault();
+       }
+     };

      rootElement.addEventListener("touchstart", handleTouchStart, {
```

**Chunk 3**
Lines added: 5, lines removed: undefined

```diff
@@ -227,4 +238,9 @@
        passive: false,
      });
+
+     // Also prevent scrolling on document level when dragging
+     document.addEventListener("touchmove", handleDocumentTouchMove, {
+       passive: false,
+     });

      return () =&gt; {
```

**Chunk 4**
Lines added: 1, lines removed: undefined

```diff
@@ -233,4 +249,5 @@
        rootElement.removeEventListener("touchend", handleTouchEnd);
        rootElement.removeEventListener("touchcancel", handleTouchEnd);
+       document.removeEventListener("touchmove", handleDocumentTouchMove);
      };
    }, []);
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -256,5 +256,5 @@
      &lt;OriginCropper.Root
        {...props}
-       ref={rootRef}
+       ref={rootRef as React.Ref&lt;HTMLDivElement&gt;}
        image={imageUrl}
        aspectRatio={aspectRatio}
```

</details>

</tool-use>

---

---

Checking for TypeScript and lint errors:

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `packages/hip-ui/src/components/image-cropper/index.tsx`

Lint results

**No lint errors found**

</details>
</tool-use>

---

---

Switching to a callback ref for better reliability:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -168,5 +168,5 @@
  }: ImageCropperRootProps) {
    const [imageUrl, setImageUrl] = useState&lt;string&gt;(() =&gt; "");
-   const rootRef = useRef&lt;HTMLDivElement&gt;(null);
+   const rootRef = useRef&lt;HTMLDivElement | null&gt;(null);

    const handleError = () =&gt; {
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/andrew/Documents/hip-ui/packages/hip-ui/src/components/image-cropper/index.tsx</summary>

**Chunk 1**
Lines added: 5, lines removed: 1

```diff
@@ -252,9 +252,13 @@
      };
    }, []);
+
+   const setRootRef = (element: HTMLDivElement | null) =&gt; {
+     rootRef.current = element;
+   };

    return (
      &lt;OriginCropper.Root
        {...props}
-       ref={rootRef as React.Ref&lt;HTMLDivElement&gt;}
+       ref={setRootRef}
        image={imageUrl}
        aspectRatio={aspectRatio}
```

</details>

</tool-use>

---

---

Rechecking lints:

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `packages/hip-ui/src/components/image-cropper/index.tsx`

Lint results

**No lint errors found**

</details>
</tool-use>

---

---

## Summary

Fixed mobile page scrolling during drag in the image cropper by:

1. **Added touch event handlers** — Listen for `touchstart`, `touchmove`, `touchend`, and `touchcancel` on the cropper root element.
2. **Prevented default behavior** — During drag, `preventDefault()` on touch events stops scrolling.
3. **Document-level prevention** — Also prevent `touchmove` on the document during drag to stop page scrolling.

The implementation:

- Uses a callback ref to get the DOM element
- Tracks drag state with an `isDragging` flag
- Only prevents scrolling when touches start within the cropper element
- Cleans up event listeners on unmount

This works with the existing `touchAction: "none"` CSS to prevent page scrolling while dragging the precrop area on mobile.

---
